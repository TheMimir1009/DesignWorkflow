# SPEC-DEBUG-001: 수용 기준 (Acceptance Criteria)

## 개요

이 문서는 LLM Debug Console 기능(SPEC-DEBUG-001)의 수용 기준을 Given/When/Then 형식으로 정의합니다.

---

## 1. 핵심 시나리오

### AC-001: Debug Console 접근

**기능**: 개발 모드에서 Debug Console 접근

```gherkin
시나리오: 개발자가 Debug Console 메뉴를 클릭하여 콘솔을 연다

Given: 사용자가 개발 모드로 애플리케이션을 실행하고 있고
  And: 사용자가 로그인한 상태일 때

When: 사용자가 사이드바의 "Debug Console" 메뉴를 클릭하면

Then: Debug Console 뷰가 표시되고
  And: 통계 요약이 표시되고
  And: 로그 목록이 표시된다
```

### AC-002: 자동 로깅

**기능**: LLM API 호출 자동 로깅

```gherkin
시나리오: LLM API 호출이 자동으로 로그에 기록된다

Given: 사용자가 Debug Console이 열려있는 상태이고
  And: Debug Console이 비어있을 때

When: LLM API 호출이 발생하면

Then: 새로운 로그 항목이 목록에 추가되고
  And: 로그 상태가 "pending"으로 표시되고
  And: 모델명이 표시되고
  And: 요청 시간이 표시된다
```

### AC-003: 성공한 요청 로그

**기능**: 성공한 API 호출 로그 업데이트

```gherkin
시나리오: API 호출이 성공하면 로그가 업데이트된다

Given: LLM API 호출이 "pending" 상태로 로그되어 있을 때

When: API 호출이 성공적으로 완료되면

Then: 로그 상태가 "success"로 변경되고
  And: 녹색 성공 인디케이터가 표시되고
  And: 사용된 토큰 수가 표시되고
  And: 비용이 계산되어 표시되고
  And: 응답 시간이 표시된다
```

### AC-004: 실패한 요청 로그

**기능**: 실패한 API 호출 로그 업데이트

```gherkin
시나리오: API 호출이 실패하면 에러 로그가 기록된다

Given: LLM API 호출이 "pending" 상태로 로그되어 있을 때

When: API 호출이 실패하면

Then: 로그 상태가 "error"로 변경되고
  And: 적색 에러 인디케이터가 표시되고
  And: 에러 메시지가 표시된다
```

### AC-005: 로그 상세 보기

**기능**: 로그 항목 클릭 시 상세 정보 표시

```gherkin
시나리오: 로그 항목을 클릭하여 요청/응답 상세를 본다

Given: Debug Console에 로그가 표시되어 있을 때

When: 사용자가 특정 로그 항목을 클릭하면

Then: 상세 보기 모달이 열리고
  And: 요청 헤더가 표시되고
  And: 요청 바디가 표시되고
  And: 응답 헤더가 표시되고
  And: 응답 바디가 표시되고
  And: API 키는 마스킹되어 표시된다
```

### AC-006: 통계 요약

**기능**: Debug Console 통계 표시

```gherkin
시나리오: 통계 요약에 전체 통계가 표시된다

Given: Debug Console에 다음 로그가 있을 때:
  | 총 요청 | 성공 | 실패 | 총 토큰 |
  | 245    | 231  | 14   | 52,400  |

When: 사용자가 통계 요약을 확인하면

Then: "245 Requests"가 표시되고
  And: "231 Success"가 녹색으로 표시되고
  And: "14 Failed"가 적색으로 표시되고
  And: "52.4K Tokens"가 표시된다
```

### AC-007: 로그 필터링

**기능**: 상태별 로그 필터링

```gherkin
시나리오: 필터를 사용하여 특정 상태의 로그만 본다

Given: Debug Console에 성공, 실패, 대기 중인 로그가 섞여 있을 때

When: 사용자가 상태 필터를 "Error"로 변경하면

Then: 실패한 로그만 표시되고
  And: 성공한 로그는 숨겨지고
  And: 필터 상태가 표시된다
```

### AC-008: 검색 기능

**기능**: 모델명으로 로그 검색

```gherkin
시나리오: 검색어를 입력하여 특정 모델의 로그를 찾는다

Given: Debug Console에 여러 모델의 로그가 있을 때

When: 사용자가 검색창에 "claude-opus"를 입력하면

Then: 모델명에 "claude-opus"가 포함된 로그만 표시된다
```

---

## 2. 재시도 시나리오

### AC-009: 실패한 요청 재시도

**기능**: 실패한 요청 재시도

```gherkin
시나리오: 실패한 요청을 다시 시도한다

Given: 실패한 상태의 로그 항목이 있고
  And: 사용자가 해당 로그의 상세 모달을 열었을 때

When: 사용자가 "재시도" 버튼을 클릭하면

Then: 동일한 파라미터로 새로운 API 호출이 생성되고
  And: 새로운 로그 항목이 추가되고
  And: 원래 로그는 그대로 유지된다
```

---

## 3. 내보내기 시나리오

### AC-010: JSON 내보내기

**기능**: 로그를 JSON 파일로 내보내기

```gherkin
시나리오: 로그를 JSON 파일로 다운로드한다

Given: Debug Console에 로그가 표시되어 있을 때

When: 사용자가 "내보내기" 버튼을 클릭하고 "JSON"을 선택하면

Then: JSON 파일 다운로드가 시작되고
  And: 파일명이 "debug-logs-{timestamp}.json" 형식이고
  And: 모든 로그 데이터가 포함된다
```

### AC-011: CSV 내보내기

**기능**: 로그를 CSV 파일로 내보내기

```gherkin
시나리오: 로그를 CSV 파일로 다운로드한다

Given: Debug Console에 로그가 표시되어 있을 때

When: 사용자가 "내보내기" 버튼을 클릭하고 "CSV"를 선택하면

Then: CSV 파일 다운로드가 시작되고
  And: 파일명이 "debug-logs-{timestamp}.csv" 형식이고
  And: 시간, 모델, 상태, 토큰, 비용 열이 포함된다
```

---

## 4. 로그 관리 시나리오

### AC-012: 로그 지우기

**기능**: 모든 로그 삭제

```gherkin
시나리오: 모든 로그를 지운다

Given: Debug Console에 로그가 표시되어 있을 때

When: 사용자가 "지우기" 버튼을 클릭하고 확인 대화상자에서 확인을 클릭하면

Then: 모든 로그가 삭제되고
  And: 빈 상태 메시지가 표시되고
  And: 통계가 0으로 초기화된다
```

### AC-013: 로그 개수 제한

**기능**: 로그 최대 개수 제한

```gherkin
시나리오: 로그가 1000개를 초과하면 가장 오래된 로그가 삭제된다

Given: Debug Console에 1000개의 로그가 있을 때

When: 새로운 API 호출이 발생하면

Then: 가장 오래된 로그가 삭제되고
  And: 새로운 로그가 추가되고
  And: 전체 로그 수가 1000개로 유지된다
```

---

## 5. 보안 시나리오

### AC-014: API 키 마스킹

**기능**: API 키 마스킹 표시

```gherkin
시나리오: API 키가 로그에서 마스킹되어 표시된다

Given: 요청 헤더에 "x-api-key: sk-ant-api123-abc456-xyz789"가 있을 때

When: 사용자가 로그 상세를 확인하면

Then: 헤더에 "x-api-key: sk-ant-****...****"가 표시되고
  And: 전체 API 키는 절대 표시되지 않는다
```

### AC-015: 개발 모드 제한

**기능**: 프로덕션에서 Debug Console 숨김

```gherkin
시나리오: 프로덕션 모드에서는 Debug Console이 표시되지 않는다

Given: 애플리케이션이 프로덕션 모드로 실행될 때

When: 사용자가 애플리케이션에 접속하면

Then: 사이드바에 "Debug Console" 메뉴가 표시되지 않는다
```

---

## 6. 빈 상태 시나리오

### AC-016: 빈 로그 상태

**기능**: 로그가 없을 때 안내 메시지 표시

```gherkin
시나리오: 로그가 없을 때 안내 메시지를 표시한다

Given: Debug Console이 열려있고
  And: 아직 로그가 없을 때

When: 사용자가 Debug Console을 확인하면

Then: "아직 LLM 호출 로그가 없습니다" 메시지가 표시되고
  And: LLM 호출을 시작하라는 안내가 표시된다
```

---

## 7. 비용 계산 시나리오

### AC-017: 토큰 비용 계산

**기능**: 사용된 토큰에 따른 비용 계산

```gherkin
시나리오: Claude Opus 모델 사용 비용을 정확히 계산한다

Given: Claude Opus 4.5 가격이 입력 $3.0/1K토큰, 출력 $15.0/1K토큰이고
  And: API 호출이 845 입력 토큰, 400 출력 토큰을 사용했을 때

When: 비용이 계산되면

Then: 입력 비용은 $2.535 (845 * 3.0 / 1000)이고
  And: 출력 비용은 $6.000 (400 * 15.0 / 1000)이고
  And: 총 비용은 $8.535로 표시된다
```

### AC-018: 통계 비용 합계

**기능**: 전체 통계의 비용 합계

```gherkin
시나리오: 모든 로그의 비용이 합산되어 표시된다

Given: Debug Console에 다음 로그가 있을 때:
  | 로그 | 비용   |
  | 1    | $0.025 |
  | 2    | $0.018 |
  | 3    | $0.042 |

When: 사용자가 통계 요약을 확인하면

Then: 총 비용이 "$0.085"로 표시된다
```

---

## 8. 테스트 요약

| AC ID | 기능 | 우선순위 | 자동화 |
|-------|------|----------|--------|
| AC-001 | Debug Console 접근 | 필수 | 가능 |
| AC-002 | 자동 로깅 | 필수 | 가능 |
| AC-003 | 성공한 요청 로그 | 필수 | 가능 |
| AC-004 | 실패한 요청 로그 | 필수 | 가능 |
| AC-005 | 로그 상세 보기 | 필수 | 가능 |
| AC-006 | 통계 요약 | 필수 | 가능 |
| AC-007 | 로그 필터링 | 필수 | 가능 |
| AC-008 | 검색 기능 | 권장 | 가능 |
| AC-009 | 실패한 요청 재시도 | 권장 | 가능 |
| AC-010 | JSON 내보내기 | 권장 | 가능 |
| AC-011 | CSV 내보내기 | 권장 | 가능 |
| AC-012 | 로그 지우기 | 필수 | 가능 |
| AC-013 | 로그 개수 제한 | 필수 | 가능 |
| AC-014 | API 키 마스킹 | 필수 | 가능 |
| AC-015 | 개발 모드 제한 | 필수 | 가능 |
| AC-016 | 빈 로그 상태 | 권장 | 가능 |
| AC-017 | 토큰 비용 계산 | 필수 | 가능 |
| AC-018 | 통계 비용 합계 | 필수 | 가능 |

---

## 9. 테스트 커버리지 목표

- **필수 AC 통과율**: 100%
- **권장 AC 통과율**: 80% 이상
- **코드 커버리지**: 85% 이상
- **보안 테스트**: 100% (API 키 마스킹, 개발 모드)
