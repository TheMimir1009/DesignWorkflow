# SPEC-REFERENCE-001: 수락 기준

## 메타데이터

| 항목 | 값 |
|------|-----|
| SPEC ID | SPEC-REFERENCE-001 |
| 문서 유형 | Acceptance Criteria |
| 생성일 | 2026-01-02 |
| 관련 문서 | spec.md, plan.md |

---

## 1. 수락 기준 개요

이 문서는 SPEC-REFERENCE-001 (참조 시스템 선택) 기능의 수락 기준을 Given-When-Then 형식으로 정의합니다.

---

## 2. 헤더 참조 태그바 (FR-001)

### AC-001: 선택된 참조 시스템 태그 표시

**Given** 사용자가 프로젝트를 선택한 상태이고
**And** 2개의 시스템 문서 (Character, Combat)가 참조로 선택되어 있을 때
**When** 헤더 영역을 확인하면
**Then** `[Character x]` `[Combat x]` 형태의 태그가 표시되어야 한다
**And** 각 태그에 x 버튼이 있어야 한다

### AC-002: 태그 x 버튼으로 참조 제거

**Given** 참조 태그 `[Character x]`가 헤더에 표시되어 있을 때
**When** 사용자가 x 버튼을 클릭하면
**Then** 해당 태그가 헤더에서 즉시 사라져야 한다
**And** referenceStore의 selectedReferences에서 해당 ID가 제거되어야 한다
**And** 사이드바의 Character 체크박스가 해제되어야 한다

### AC-003: [+ Add] 버튼 표시

**Given** 사용자가 헤더 참조 태그바 영역에 있을 때
**When** 태그바 우측을 확인하면
**Then** `[+ Add]` 버튼이 표시되어야 한다

### AC-004: 참조 시스템이 없을 때 플레이스홀더

**Given** 선택된 참조 시스템이 없을 때
**When** 헤더 태그바 영역을 확인하면
**Then** "참조 시스템을 선택하세요" 플레이스홀더가 표시되어야 한다
**And** `[+ Add]` 버튼은 계속 표시되어야 한다

### AC-005: 5개 초과 시 축약 표시

**Given** 7개의 시스템 문서가 참조로 선택되어 있을 때
**When** 헤더 태그바를 확인하면
**Then** 첫 5개의 태그가 표시되어야 한다
**And** `+2 more` 형태의 축약 표시가 있어야 한다

---

## 3. 검색 드롭다운 (FR-002)

### AC-006: [+ Add] 클릭 시 드롭다운 열기

**Given** 사용자가 헤더의 `[+ Add]` 버튼 위에 있을 때
**When** 버튼을 클릭하면
**Then** ReferenceSearchDropdown이 버튼 아래에 표시되어야 한다
**And** 검색 입력란에 자동으로 포커스가 가야 한다

### AC-007: 검색어 입력 시 필터링

**Given** 검색 드롭다운이 열려 있고
**And** 시스템 문서 목록에 "Character", "Combat", "Economy"가 있을 때
**When** 사용자가 "Cha"를 입력하면
**Then** 300ms 디바운스 후 "Character"만 표시되어야 한다
**And** 다른 시스템은 숨겨져야 한다

### AC-008: 검색 결과 클릭 시 참조 추가

**Given** 검색 드롭다운에 "Character" 결과가 표시되어 있고
**And** Character가 아직 참조에 추가되지 않았을 때
**When** 사용자가 "Character" 항목을 클릭하면
**Then** Character가 referenceStore.selectedReferences에 추가되어야 한다
**And** 헤더 태그바에 `[Character x]` 태그가 표시되어야 한다
**And** 드롭다운이 닫혀야 한다

### AC-009: 이미 선택된 시스템 표시

**Given** 검색 드롭다운이 열려 있고
**And** "Character"가 이미 참조로 선택되어 있을 때
**When** 드롭다운 목록을 확인하면
**Then** "Character" 항목 옆에 체크 표시가 있어야 한다

### AC-010: 검색 결과 없음 메시지

**Given** 검색 드롭다운이 열려 있을 때
**When** 사용자가 "xyz123"(존재하지 않는 이름)을 입력하면
**Then** "검색 결과가 없습니다" 메시지가 표시되어야 한다

### AC-011: 외부 클릭으로 드롭다운 닫기

**Given** 검색 드롭다운이 열려 있을 때
**When** 사용자가 드롭다운 외부 영역을 클릭하면
**Then** 드롭다운이 닫혀야 한다

### AC-012: ESC 키로 드롭다운 닫기

**Given** 검색 드롭다운이 열려 있고
**And** 검색 입력란에 포커스가 있을 때
**When** 사용자가 ESC 키를 누르면
**Then** 드롭다운이 닫혀야 한다

---

## 4. 접이식 사이드바 (FR-003)

### AC-013: 카테고리별 시스템 목록 표시

**Given** 프로젝트가 선택되어 있고
**And** 시스템 문서가 "전투", "경제", "성장" 카테고리에 분류되어 있을 때
**When** 사이드바를 확인하면
**Then** 각 카테고리별로 그룹화된 시스템 목록이 표시되어야 한다
**And** 각 카테고리 헤더에 펼치기/접기 화살표가 있어야 한다

### AC-014: 카테고리 접기/펼치기

**Given** "전투" 카테고리가 펼쳐져 있고
**And** 하위에 3개의 시스템 문서가 표시되어 있을 때
**When** 사용자가 "전투" 카테고리 헤더를 클릭하면
**Then** 하위 시스템 문서 목록이 숨겨져야 한다
**And** 카테고리 헤더의 화살표가 접힌 상태로 변경되어야 한다

### AC-015: 체크박스로 참조 선택

**Given** 사이드바에 "Character" 시스템 문서가 표시되어 있고
**And** 체크박스가 해제된 상태일 때
**When** 사용자가 체크박스를 클릭하면
**Then** 체크박스가 선택 상태로 변경되어야 한다
**And** referenceStore.selectedReferences에 Character ID가 추가되어야 한다
**And** 헤더 태그바에 `[Character x]` 태그가 표시되어야 한다

### AC-016: 체크박스로 참조 해제

**Given** "Character" 시스템 문서의 체크박스가 선택된 상태일 때
**When** 사용자가 체크박스를 클릭하면
**Then** 체크박스가 해제 상태로 변경되어야 한다
**And** referenceStore.selectedReferences에서 Character ID가 제거되어야 한다
**And** 헤더 태그바에서 `[Character x]` 태그가 사라져야 한다

### AC-017: 사이드바 접기/펼치기 토글

**Given** 사이드바가 펼쳐진 상태 (280px)일 때
**When** 사용자가 토글 버튼 ([<<])을 클릭하면
**Then** 사이드바가 접힌 상태 (48px)로 변경되어야 한다
**And** 아이콘만 표시되는 축소 모드로 전환되어야 한다
**And** 200ms 트랜지션 애니메이션이 적용되어야 한다

### AC-018: 사이드바 검색 필터링

**Given** 사이드바가 펼쳐져 있고
**And** 검색 입력란이 표시되어 있을 때
**When** 사용자가 "전투"를 입력하면
**Then** 이름이나 태그에 "전투"가 포함된 시스템만 표시되어야 한다

### AC-019: 태그 필터링

**Given** 사이드바에 태그 필터 영역이 있고
**And** [PvP], [밸런스], [경험치] 태그 버튼이 있을 때
**When** 사용자가 [PvP] 태그를 클릭하면
**Then** "PvP" 태그를 가진 시스템 문서만 표시되어야 한다

### AC-020: 프로젝트 미선택 시 메시지

**Given** 현재 선택된 프로젝트가 없을 때
**When** 사이드바를 확인하면
**Then** "프로젝트를 선택하세요" 메시지가 표시되어야 한다

### AC-021: 시스템 문서 없음 메시지

**Given** 프로젝트가 선택되어 있지만
**And** 해당 프로젝트에 시스템 문서가 없을 때
**When** 사이드바를 확인하면
**Then** "시스템 문서가 없습니다" 메시지가 표시되어야 한다

---

## 5. 시스템 문서 미리보기 (FR-004)

### AC-022: 눈 버튼 클릭으로 미리보기 열기

**Given** 사이드바에 "Character" 시스템 문서가 표시되어 있을 때
**When** 사용자가 눈 아이콘 버튼을 클릭하면
**Then** SystemPreview 모달이 열려야 한다
**And** Character 시스템 문서의 내용이 마크다운으로 렌더링되어야 한다

### AC-023: 미리보기 모달 닫기

**Given** SystemPreview 모달이 열려 있을 때
**When** 사용자가 닫기 버튼(X)을 클릭하면
**Then** 모달이 닫혀야 한다

### AC-024: ESC 키로 미리보기 닫기

**Given** SystemPreview 모달이 열려 있을 때
**When** 사용자가 ESC 키를 누르면
**Then** 모달이 닫혀야 한다

### AC-025: 미리보기에서 참조 추가

**Given** SystemPreview 모달이 열려 있고
**And** 해당 시스템이 참조에 추가되지 않았을 때
**When** 사용자가 "참조에 추가" 버튼을 클릭하면
**Then** 해당 시스템이 참조에 추가되어야 한다
**And** 모달이 닫혀야 한다
**And** 헤더 태그바에 해당 시스템 태그가 표시되어야 한다

### AC-026: 이미 추가된 시스템 버튼 비활성화

**Given** SystemPreview 모달이 열려 있고
**And** 해당 시스템이 이미 참조에 추가되어 있을 때
**When** 버튼 영역을 확인하면
**Then** "이미 추가됨" 텍스트와 함께 버튼이 비활성화되어야 한다

### AC-027: 미리보기 로딩 상태

**Given** 사용자가 눈 버튼을 클릭했을 때
**When** 시스템 문서 내용이 로딩 중이면
**Then** 로딩 스피너가 표시되어야 한다

---

## 6. 기본 참조 시스템 설정 (FR-005)

### AC-028: 기본값으로 저장

**Given** 3개의 시스템 문서 (Character, Combat, Economy)가 참조로 선택되어 있을 때
**When** 사용자가 "기본값으로 저장" 버튼을 클릭하면
**Then** PUT /api/projects/:projectId/default-references API가 호출되어야 한다
**And** 성공 시 "기본 참조가 저장되었습니다" 토스트가 표시되어야 한다

### AC-029: 기본 참조 자동 로드

**Given** 프로젝트에 기본 참조 시스템 (Character, Combat)이 설정되어 있고
**And** 사용자가 해당 프로젝트를 선택할 때
**When** 프로젝트 전환이 완료되면
**Then** referenceStore.selectedReferences에 Character, Combat ID가 로드되어야 한다
**And** 헤더 태그바에 해당 태그들이 표시되어야 한다

### AC-030: 새 태스크 생성 시 기본 참조 적용

**Given** 프로젝트에 기본 참조 시스템이 설정되어 있을 때
**When** 사용자가 새 태스크를 생성하면
**Then** 태스크의 references 배열에 기본 참조 시스템 ID가 포함되어야 한다

### AC-031: ProjectSettingsModal에서 기본 참조 수정

**Given** ProjectSettingsModal이 열려 있고
**And** 기본 참조 시스템 설정 탭이 있을 때
**When** 사용자가 기본 참조 시스템을 변경하고 저장하면
**Then** project.json의 defaultReferences가 업데이트되어야 한다

---

## 7. 비기능 요구사항 테스트

### AC-032: 성능 - 시스템 목록 로드

**Given** 프로젝트에 50개의 시스템 문서가 있을 때
**When** 사이드바가 시스템 목록을 로드하면
**Then** 500ms 이내에 목록이 표시되어야 한다

### AC-033: 성능 - 검색 디바운스

**Given** 검색 드롭다운이 열려 있을 때
**When** 사용자가 빠르게 "test"를 입력하면
**Then** API 호출이 1회만 발생해야 한다 (300ms 디바운스)

### AC-034: 사용성 - 키보드 네비게이션

**Given** 검색 드롭다운이 열려 있고 검색 결과가 있을 때
**When** 사용자가 Tab 키로 이동하고 Enter 키를 누르면
**Then** 포커스된 시스템이 참조에 추가되어야 한다

### AC-035: 접근성 - ARIA 라벨

**Given** 사이드바의 시스템 문서 체크박스가 있을 때
**When** 스크린 리더로 접근하면
**Then** "Character 시스템 참조 선택" 형태의 라벨이 읽혀야 한다

---

## 8. 품질 게이트

### 8.1 테스트 커버리지

- 단위 테스트 커버리지: 85% 이상
- 주요 사용자 시나리오 E2E 테스트: 100%

### 8.2 코드 품질

- ESLint 경고 0건
- TypeScript 컴파일 에러 0건
- Prettier 포맷팅 적용

### 8.3 Definition of Done

- [ ] 모든 AC (AC-001 ~ AC-035) 통과
- [ ] 단위 테스트 작성 및 통과
- [ ] E2E 테스트 시나리오 통과
- [ ] 코드 리뷰 완료
- [ ] 문서 업데이트 완료

---

## 9. 추적성 태그

| 수락 기준 | 관련 요구사항 |
|-----------|---------------|
| AC-001 ~ AC-005 | FR-001 (헤더 참조 태그바) |
| AC-006 ~ AC-012 | FR-002 (검색 드롭다운) |
| AC-013 ~ AC-021 | FR-003 (접이식 사이드바) |
| AC-022 ~ AC-027 | FR-004 (시스템 미리보기) |
| AC-028 ~ AC-031 | FR-005 (기본 참조 설정) |
| AC-032 ~ AC-035 | NFR-001 ~ NFR-003 (비기능 요구사항) |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|-----------|
| 1.0 | 2026-01-02 | 초안 작성 |
