# SPEC-PASSTHROUGH-001: 인수 기준

## 메타데이터

| 항목 | 값 |
|------|-----|
| SPEC ID | SPEC-PASSTHROUGH-001 |
| 제목 | 패스쓰루 자동 파이프라인 인수 기준 |
| 생성일 | 2026-01-14 |
| 작성자 | Mimir |

---

## 1. 인수 테스트 시나리오

### AC-001: 패스쓰루 파이프라인 시작

**시나리오**: Q&A 완료 후 자동 생성 시작

```gherkin
Feature: 패스쓰루 파이프라인 시작
  기획자로서
  Q&A를 완료한 후
  버튼 한 번으로 전체 문서를 자동 생성하고 싶다

  Background:
    Given 프로젝트가 선택되어 있다
    And 태스크가 Feature List 단계에 있다
    And Q&A가 완료된 상태이다

  Scenario: 패스쓰루 정상 시작
    Given Q&A 답변이 모두 입력되어 있다
    When 사용자가 "자동 생성" 버튼을 클릭한다
    Then 파이프라인 상태가 "running"으로 변경된다
    And 첫 번째 단계(Design Doc)가 "running" 상태로 표시된다
    And 진행률이 0%에서 시작한다
    And "일시정지"와 "취소" 버튼이 활성화된다

  Scenario: Q&A 미완료 시 시작 불가
    Given Q&A가 완료되지 않은 상태이다
    When 사용자가 "자동 생성" 버튼을 클릭한다
    Then "Q&A를 먼저 완료해주세요" 에러 메시지가 표시된다
    And 파이프라인이 시작되지 않는다

  Scenario: 중복 실행 방지
    Given 파이프라인이 이미 실행 중이다
    When 사용자가 "자동 생성" 버튼을 클릭한다
    Then "이미 실행 중인 파이프라인이 있습니다" 메시지가 표시된다
    And 새로운 파이프라인이 시작되지 않는다
```

---

### AC-002: 일시정지 및 재개

**시나리오**: 실행 중 일시정지 후 재개

```gherkin
Feature: 패스쓰루 일시정지 및 재개
  기획자로서
  실행 중인 파이프라인을 일시정지하고
  나중에 다시 재개하고 싶다

  Background:
    Given 패스쓰루 파이프라인이 실행 중이다
    And 현재 Design Doc 단계가 진행 중이다

  Scenario: 일시정지 요청
    When 사용자가 "일시정지" 버튼을 클릭한다
    Then 현재 단계(Design Doc)가 완료될 때까지 대기한다
    And 현재 단계 완료 후 파이프라인 상태가 "paused"로 변경된다
    And "재개"와 "취소" 버튼이 활성화된다
    And "일시정지" 버튼이 비활성화된다

  Scenario: 일시정지 후 재개
    Given 파이프라인이 "paused" 상태이다
    And Design Doc 단계가 완료되어 있다
    When 사용자가 "재개" 버튼을 클릭한다
    Then 파이프라인 상태가 "running"으로 변경된다
    And 다음 단계(PRD)가 시작된다
    And "일시정지"와 "취소" 버튼이 활성화된다

  Scenario: 일시정지 상태에서 취소
    Given 파이프라인이 "paused" 상태이다
    When 사용자가 "취소" 버튼을 클릭한다
    Then "파이프라인을 취소하시겠습니까?" 확인 다이얼로그가 표시된다
    When 사용자가 "확인"을 클릭한다
    Then 파이프라인 상태가 "cancelled"로 변경된다
```

---

### AC-003: 취소 처리

**시나리오**: 실행 중 파이프라인 취소

```gherkin
Feature: 패스쓰루 취소
  기획자로서
  실행 중인 파이프라인을 즉시 취소하고 싶다

  Background:
    Given 패스쓰루 파이프라인이 실행 중이다

  Scenario: 실행 중 취소
    When 사용자가 "취소" 버튼을 클릭한다
    Then "파이프라인을 취소하시겠습니까? 진행 중인 작업이 중단됩니다." 확인 다이얼로그가 표시된다
    When 사용자가 "확인"을 클릭한다
    Then 파이프라인이 즉시 중단된다
    And 파이프라인 상태가 "cancelled"로 변경된다
    And 완료된 단계의 문서는 유지된다
    And "자동 생성" 버튼이 활성화된다

  Scenario: 취소 확인에서 취소
    When 사용자가 "취소" 버튼을 클릭한다
    And 확인 다이얼로그에서 "취소"를 클릭한다
    Then 파이프라인이 계속 실행된다
    And 상태가 변경되지 않는다
```

---

### AC-004: 에러 처리 및 재시도

**시나리오**: 문서 생성 실패 시 에러 처리

```gherkin
Feature: 패스쓰루 에러 처리
  기획자로서
  문서 생성 실패 시 구체적인 에러 정보를 확인하고
  재시도할 수 있어야 한다

  Background:
    Given 패스쓰루 파이프라인이 실행 중이다
    And PRD 단계가 진행 중이다

  Scenario: 문서 생성 실패
    Given LLM API 호출이 실패한다
    When PRD 생성 API가 에러를 반환한다
    Then 파이프라인 상태가 "failed"로 변경된다
    And PRD 단계가 "failed" 상태로 표시된다
    And 에러 메시지가 표시된다: "PRD 생성에 실패했습니다"
    And 에러 상세 정보가 표시된다: API 에러 코드 및 메시지
    And "재시도" 버튼이 표시된다

  Scenario: 실패한 단계 재시도
    Given 파이프라인이 "failed" 상태이다
    And PRD 단계가 실패한 상태이다
    And 재시도 횟수가 3회 미만이다
    When 사용자가 "재시도" 버튼을 클릭한다
    Then 파이프라인 상태가 "running"으로 변경된다
    And PRD 단계가 다시 시작된다
    And 재시도 횟수가 1 증가한다

  Scenario: 재시도 횟수 초과
    Given 파이프라인이 "failed" 상태이다
    And PRD 단계 재시도 횟수가 3회이다
    When 사용자가 "재시도" 버튼을 클릭한다
    Then "재시도 횟수를 초과했습니다. 수동으로 해결해주세요." 메시지가 표시된다
    And 재시도가 실행되지 않는다

  Scenario: 타임아웃 에러
    Given 문서 생성이 120초 이상 소요된다
    When 타임아웃이 발생한다
    Then 파이프라인 상태가 "failed"로 변경된다
    And "요청 시간이 초과되었습니다. 네트워크 상태를 확인하고 재시도해주세요." 메시지가 표시된다
```

---

### AC-005: 상태 복구

**시나리오**: 브라우저 새로고침 후 상태 복구

```gherkin
Feature: 패스쓰루 상태 복구
  기획자로서
  브라우저를 새로고침해도
  파이프라인 진행 상태가 유지되어야 한다

  Background:
    Given 패스쓰루 파이프라인이 실행 중이다
    And Design Doc 단계가 완료되었다
    And PRD 단계가 진행 중이다

  Scenario: 새로고침 후 실행 중 상태 복구
    When 사용자가 브라우저를 새로고침한다
    Then 저장된 파이프라인 상태가 로드된다
    And Design Doc 단계가 "completed" 상태로 표시된다
    And PRD 단계가 "running" 상태로 표시된다
    And 진행률이 복구된다 (약 50%)
    And 폴링이 자동으로 시작된다

  Scenario: 새로고침 후 일시정지 상태 복구
    Given 파이프라인이 "paused" 상태이다
    When 사용자가 브라우저를 새로고침한다
    Then 파이프라인 상태가 "paused"로 복구된다
    And "재개" 버튼이 활성화된다
    And 마지막 완료 단계 정보가 표시된다

  Scenario: 저장된 상태가 없는 경우
    Given 저장된 파이프라인 상태가 없다
    When 사용자가 페이지를 로드한다
    Then 파이프라인 상태가 "idle"로 초기화된다
    And "자동 생성" 버튼이 표시된다
```

---

### AC-006: 완료 처리

**시나리오**: 전체 파이프라인 완료

```gherkin
Feature: 패스쓰루 완료
  기획자로서
  모든 문서가 생성되면
  완료 상태를 확인하고 결과물을 확인하고 싶다

  Background:
    Given 패스쓰루 파이프라인이 실행 중이다
    And Design Doc과 PRD 단계가 완료되었다
    And Prototype 단계가 진행 중이다

  Scenario: 전체 파이프라인 완료
    When Prototype 생성이 성공적으로 완료된다
    Then 파이프라인 상태가 "completed"로 변경된다
    And 진행률이 100%로 표시된다
    And 모든 단계가 "completed" 상태로 표시된다
    And "완료되었습니다!" 성공 메시지가 표시된다
    And 각 문서에 대한 링크가 표시된다
    And 태스크가 Prototype 컬럼으로 이동된다

  Scenario: 완료 후 재실행
    Given 파이프라인이 "completed" 상태이다
    When 사용자가 "자동 생성" 버튼을 클릭한다
    Then "기존 문서를 덮어쓰시겠습니까?" 확인 다이얼로그가 표시된다
    When 사용자가 "확인"을 클릭한다
    Then 새로운 파이프라인이 시작된다
    And 기존 문서에 새 버전이 생성된다
```

---

### AC-007: 진행률 표시

**시나리오**: 실시간 진행률 업데이트

```gherkin
Feature: 패스쓰루 진행률 표시
  기획자로서
  파이프라인 진행 상태를 실시간으로 확인하고 싶다

  Scenario: 초기 상태 진행률
    Given 파이프라인이 시작되었다
    When Design Doc 단계가 시작된다
    Then 진행률이 0%로 표시된다
    And "Design Doc 생성 중..." 메시지가 표시된다

  Scenario: 단계별 진행률 업데이트
    Given Design Doc 단계가 완료되었다
    When PRD 단계가 시작된다
    Then 진행률이 33%로 업데이트된다
    And "PRD 생성 중..." 메시지가 표시된다

  Scenario: 마지막 단계 진행률
    Given PRD 단계가 완료되었다
    When Prototype 단계가 시작된다
    Then 진행률이 66%로 업데이트된다
    And "Prototype 생성 중..." 메시지가 표시된다

  Scenario: 완료 시 진행률
    When Prototype 단계가 완료된다
    Then 진행률이 100%로 업데이트된다
    And "모든 문서가 생성되었습니다" 메시지가 표시된다
```

---

### AC-008: 칸반 카드 연동

**시나리오**: 패스쓰루 중 칸반 카드 상태

```gherkin
Feature: 칸반 카드 연동
  기획자로서
  패스쓰루 실행 중에는 칸반 카드가 자동으로 이동해야 하고
  수동 이동은 제한되어야 한다

  Background:
    Given 태스크 카드가 Feature List 컬럼에 있다
    And 패스쓰루 파이프라인이 실행 중이다

  Scenario: 패스쓰루 중 카드 이동 제한
    Given 파이프라인 상태가 "running"이다
    When 사용자가 카드를 드래그하려고 한다
    Then 드래그가 비활성화되어 있다
    And 카드에 "자동 생성 중" 뱃지가 표시된다

  Scenario: 단계 완료 시 자동 카드 이동
    Given Design Doc 단계가 완료되었다
    When PRD 단계가 시작된다
    Then 카드가 자동으로 Design Doc 컬럼으로 이동한다
    And 카드에 진행 상태 인디케이터가 표시된다

  Scenario: 파이프라인 완료 후 수동 이동 활성화
    Given 파이프라인 상태가 "completed"이다
    And 카드가 Prototype 컬럼에 있다
    When 사용자가 카드를 드래그한다
    Then 드래그가 정상적으로 동작한다

  Scenario: 파이프라인 취소 후 수동 이동 활성화
    Given 파이프라인 상태가 "cancelled"이다
    When 사용자가 카드를 드래그한다
    Then 드래그가 정상적으로 동작한다
```

---

## 2. Edge Case 테스트

### EC-001: 네트워크 연결 끊김

```gherkin
Scenario: 실행 중 네트워크 끊김
  Given 패스쓰루 파이프라인이 실행 중이다
  When 네트워크 연결이 끊긴다
  Then 폴링 요청이 실패한다
  And "네트워크 연결을 확인해주세요" 경고가 표시된다
  And 연결 복구 시 자동으로 상태가 동기화된다
```

### EC-002: 동시 세션 접근

```gherkin
Scenario: 다른 탭에서 동시 접근
  Given 탭 A에서 패스쓰루가 실행 중이다
  When 탭 B에서 같은 태스크의 패스쓰루 상태를 조회한다
  Then 탭 B에서도 현재 진행 상태가 표시된다
  And 탭 B의 제어 버튼은 비활성화된다
  And "다른 세션에서 실행 중입니다" 메시지가 표시된다
```

### EC-003: 서버 재시작

```gherkin
Scenario: 실행 중 서버 재시작
  Given 패스쓰루 파이프라인이 실행 중이다
  And Design Doc 단계가 완료되었다
  When 서버가 재시작된다
  Then 저장된 상태가 복구된다
  And 파이프라인이 "paused" 상태로 전환된다
  And 사용자가 수동으로 재개할 수 있다
```

### EC-004: LLM 프로바이더 변경

```gherkin
Scenario: 실행 중 LLM 설정 변경
  Given 패스쓰루 파이프라인이 실행 중이다
  When 사용자가 LLM 설정을 변경한다
  Then 현재 실행 중인 단계는 기존 설정으로 완료된다
  And 다음 단계부터 새 설정이 적용된다
```

### EC-005: 빈 Q&A 답변

```gherkin
Scenario: 필수 Q&A 답변 누락
  Given Q&A 세션이 완료 상태이다
  But 일부 필수 답변이 비어있다
  When 사용자가 "자동 생성" 버튼을 클릭한다
  Then "필수 질문에 대한 답변이 누락되었습니다" 에러가 표시된다
  And 누락된 질문 목록이 표시된다
```

---

## 3. 성능 기준

### 3.1 응답 시간

| 작업 | 목표 | 최대 허용 |
|------|------|-----------|
| 파이프라인 시작 API | 500ms | 1000ms |
| 상태 폴링 API | 200ms | 500ms |
| 일시정지/재개/취소 API | 300ms | 500ms |
| UI 상태 업데이트 | 100ms | 200ms |

### 3.2 파이프라인 실행 시간

| 단계 | 예상 시간 | 타임아웃 |
|------|-----------|----------|
| Design Doc 생성 | 30-60초 | 120초 |
| PRD 생성 | 30-60초 | 120초 |
| Prototype 생성 | 30-60초 | 120초 |
| 전체 파이프라인 | 2-3분 | 6분 |

### 3.3 동시성

| 메트릭 | 목표 |
|--------|------|
| 동시 파이프라인 (프로젝트당) | 1개 |
| 동시 폴링 클라이언트 | 10개 |
| 상태 저장 지연 | 1초 이내 |

---

## 4. 테스트 체크리스트

### 4.1 기능 테스트

- [ ] 패스쓰루 시작 (Q&A 완료 상태)
- [ ] 패스쓰루 시작 거부 (Q&A 미완료 상태)
- [ ] 중복 실행 방지
- [ ] 일시정지 요청 및 처리
- [ ] 재개 요청 및 처리
- [ ] 취소 요청 및 처리
- [ ] 에러 발생 시 상태 변경
- [ ] 재시도 기능
- [ ] 재시도 횟수 제한
- [ ] 브라우저 새로고침 후 상태 복구
- [ ] 전체 파이프라인 완료

### 4.2 UI 테스트

- [ ] 진행률 표시 정확성
- [ ] 단계별 상태 아이콘
- [ ] 버튼 활성화/비활성화 상태
- [ ] 에러 메시지 표시
- [ ] 확인 다이얼로그
- [ ] 로딩 인디케이터
- [ ] 칸반 카드 뱃지

### 4.3 통합 테스트

- [ ] Q&A 완료 -> 패스쓰루 시작 연동
- [ ] LLM 설정 연동
- [ ] 칸반 카드 자동 이동
- [ ] 문서 생성 및 저장
- [ ] 버전 히스토리 생성

### 4.4 에러 처리 테스트

- [ ] LLM API 실패
- [ ] 네트워크 타임아웃
- [ ] 서버 에러 (500)
- [ ] 인증 에러 (401)
- [ ] 네트워크 끊김

---

## 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 1.0.0 | 2026-01-14 | Mimir | 초기 인수 기준 작성 |
